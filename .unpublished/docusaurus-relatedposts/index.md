---
slug: docusaurus-relatedposts
title: Displaying related posts below our Docusaurus article
authors: [christophe]
image: /img/components_social_media.jpg
serie: Creating Docusaurus components
mainTag: component
tags: [component, docusaurus, markdown, react, swizzle]
enableComments: true
blueSkyRecordKey:
draft: true
---

<!-- cspell:ignore relatedposts -->

![Displaying related posts below our Docusaurus article](/img/components_banner.jpg)

Docusaurus can display a list of tags but not related articles.

When you surf on my blog, you'll see below almost every articles a list of **Related blog posts**. For instance, just open the [Restore a Joomla backup using Docker](/blog/docker-joomla-restore-jpa).

The objective of our component will be to display something like this:

<Image img={require("./images/related.png").default} />

## We need something for extracting information from blog posts

If you don't have it yet, please create the `src/components/utils/blogPosts.js` file. It'll contain a helper function we can reuse for several components.

That helper will scan each Markdown files having the `.md` or `.mdx` extension in the `blog` sub-folder.

For each file, the script will looks at the YAML front matter and exploit some properties; f.i.:

* if the blog post has `draft: true` or `unlisted: true`, the post will be ignored,
* if the blog post has a `slug` will use it. If not, the slug will be generated by code,
* if the blog post has an associated image will use it. If not use a default one
* then the helper will simply return the list of posts and their properties.

Some properties are custom ones like `mainTag` and, for our need right now, the `serie` property.

So, just copy/paste the content of the file below and create the `src/components/utils/blogPosts.js` in your project's structure.

<Snippets filename="src/components/utils/blogPosts.js">

```javascript
const blogPosts = require.context("../../../blog", true, /\.mdx?$/);

export function getBlogMetadata() {
  return blogPosts
    .keys()
    .map((key) => {
      const post = blogPosts(key);

      const dir = key.replace(/\/index\.mdx?$/, "").replace(/^\.\//, "");

      let permalink;
      if (post.frontMatter.slug) {
        permalink = post.frontMatter.slug.startsWith("/")
          ? post.frontMatter.slug
          : `/blog/${post.frontMatter.slug.replace(/^\//, "")}`;
      } else {
        permalink = `/blog/${dir}/`;
      }

      let imageUrl = post.frontMatter.image;
      if (imageUrl && imageUrl.startsWith("./")) {
        imageUrl = `/blog/${dir}/${imageUrl.replace("./", "")}`;
      }

      return {
        title: post.frontMatter.title,
        description: post.frontMatter.description,
        image: imageUrl,
        draft: post.frontMatter.draft || false,
        unlisted: post.frontMatter.unlisted || false,
        permalink,
        tags: post.frontMatter.tags || [],
        mainTag: post.frontMatter.mainTag || null,
        authors: post.frontMatter.authors || [],
        date: post.frontMatter.date,
        serie: post.frontMatter.serie || null,
      };
    })
    .filter(Boolean);
}

```

</Snippets>

## Our RelatedPosts component

Now please create this file `src/components/RelatedBlogPosts/index.js`:

<Snippets filename="src/components/RelatedBlogPosts/index.js">

```javascript
import Link from "@docusaurus/Link";
import useBaseUrl from "@docusaurus/useBaseUrl";
import { useBlogPost } from "@docusaurus/plugin-content-blog/client";
import { getBlogMetadata } from "@site/src/components/utils/blogPosts";

export default function RelatedPosts({ count = 3, description = false }) {
  const { metadata } = useBlogPost();
  const currentPermalink = metadata.permalink;
  const mainTag = metadata.frontMatter.mainTag;
  const tags = metadata.frontMatter.tags || [];

  if (!mainTag && tags.length === 0) return null; // nothing to filter on

  const posts = getBlogMetadata();
  let filtered = posts;

  // Prefer mainTag if available
  if (mainTag) {
    const filteredByMainTag = posts.filter((post) => {
      const postTags = post.tags.map((t) =>
        typeof t === "string" ? t : t.label
      );
      return postTags.includes(mainTag);
    });

    if (filteredByMainTag.length > 0) {
      filtered = filteredByMainTag;
    } else if (tags.length > 0) {
      filtered = posts.filter((post) => {
        const postTagLabels = post.tags.map((t) =>
          typeof t === "string" ? t : t.label
        );
        return postTagLabels.some((label) => tags.includes(label));
      });
    } else {
      filtered = [];
    }
  } else if (tags.length > 0) {
    filtered = filtered.filter((post) => {
      const postTagLabels = post.tags.map((t) =>
        typeof t === "string" ? t : t.label
      );
      return postTagLabels.some((label) => tags.includes(label));
    });
  }

  // Exclude current post
  filtered = filtered.filter((post) => post.permalink !== currentPermalink);

  // Randomize and take top N
  const ordered = [...filtered].sort(() => 0.5 - Math.random());
  const related = ordered.slice(0, count);

  if (!related.length) return <p>No related posts.</p>;

  return (
    <>
      <h3>Related posts</h3>
      <div className="row">
        {related.map((post) => (
          <div
            className="col col--4"
            key={post.permalink}
            style={{ marginBottom: "2rem", display: "flex" }}
          >
            <div
              className="card"
              style={{
                width: "100%",
                display: "flex",
                flexDirection: "column",
                height: "100%",
              }}
            >
              <Link to={post.permalink}>
                <div className="card__image">
                  {post.image && (
                    <img
                      src={useBaseUrl(post.image)}
                      alt={post.title}
                      style={{
                        width: "100%",
                        height: 180,
                        objectFit: "cover",
                        borderTopLeftRadius: 8,
                        borderTopRightRadius: 8,
                      }}
                    />
                  )}
                </div>
                <div className="card__body" style={{ flex: 1 }}>
                  <h3>{post.title}</h3>
                  {description && post.description && (
                    <div
                      style={{
                        color: "#6c63ff",
                        fontWeight: "bold",
                        marginBottom: 6,
                      }}
                    >
                      {post.description}
                    </div>
                  )}
                  <p
                    style={{
                      color: "#888",
                      fontSize: "0.95em",
                      marginBottom: 8,
                    }}
                  >
                    {post.date && (
                      <span>{new Date(post.date).toLocaleDateString()}</span>
                    )}
                  </p>
                </div>
              </Link>
              <div className="card__footer" style={{ textAlign: "right" }}>
                <Link
                  className="button button--primary button--sm"
                  to={post.permalink}
                >
                  Read more
                </Link>
              </div>
            </div>
          </div>
        ))}
      </div>
    </>
  );
}

```

</Snippets>

## Overriding the BlogPostItem template

We need now to override the BlogPostItem template of Docusaurus so we can inject our `<RelatedPost>` component at the bottom of each blog post.

In a console, please run `yarn docusaurus swizzle @docusaurus/theme-classic BlogPostItem` then select, in that order, `Javascript`, then `Eject` finally `YES`.

A lot of files will be created in your Docusaurus directory's structure, in folder `src/theme/BlogPostItem`. We can safely removed all files except the `src/theme/BlogPostItem/index.js` file that we need to edit.

So, please remove any files/folders under `src/theme/BlogPostItem` except the `index.js` one.

In the code below, the highlighted lines are the ones we need to add.

<Snippets filename="src/theme/BlogPostItem/index.js">

```javascript

import React from "react";
import clsx from "clsx";
import { useBlogPost } from "@docusaurus/plugin-content-blog/client";
import BlogPostItemContainer from "@theme/BlogPostItem/Container";
import BlogPostItemHeader from "@theme/BlogPostItem/Header";
import BlogPostItemContent from "@theme/BlogPostItem/Content";
import BlogPostItemFooter from "@theme/BlogPostItem/Footer";

// highlight-next-line
import RelatedBlogPosts from "@site/src/components/RelatedBlogPosts/index.js";

// apply a bottom margin in list view
function useContainerClassName() {
  const { isBlogPostPage } = useBlogPost();
  return !isBlogPostPage ? "margin-bottom--xl" : undefined;
}
export default function BlogPostItem({ children, className }) {
  // highlight-next-line
  const { metadata, isBlogPostPage } = useBlogPost();
  const containerClassName = useContainerClassName();
  return (
    <BlogPostItemContainer className={clsx(containerClassName, className)}>
      <BlogPostItemHeader />
      <BlogPostItemContent>{children}</BlogPostItemContent>
      <BlogPostItemFooter />

      // highlight-start
      {/* Only display our RelatedBlogPosts and BlueSky components on the post page; not the blog view */}
      {isBlogPostPage && <RelatedBlogPosts count="6" description="false" />}
      // highlight-end
    </BlogPostItemContainer>
  );
}

```

</Snippets>

Now, because we've just introduced an override, we need to restart our Docusaurus server so changes can be taken into account.

:::info
If you're running Docusaurus locally, just run `npm run start` in your console.
If like me you're running Docusaurus thanks to Docker, just kill the container and run a new one.
:::

## Editing our blog posts

Once our component has been created, we need to teach Docusaurus how relations between posts can be made.

Natively, Docusaurus supports tags in the post YAML front matter like this:

```markdown
---
title: Displaying related posts below our Docusaurus article
image: /img/docusaurus_tips_social_media.jpg
<!-- highlight-next-line -->
tags: [component, docusaurus, markdown, react, swizzle]
---

```

Idea is thus to create ours called `mainTag`.

```markdown
---
title: Displaying related posts below our Docusaurus article
image: /img/docusaurus_tips_social_media.jpg
<!-- highlight-next-line -->
mainTag: component
tags: [component, docusaurus, markdown, react, swizzle]
---

```

Now, Docusaurus knows that specific article is about `component`. When he'll call the `getBlogMetadata` we've seen earlier in this article, Docusaurus will search for any blog post having, in his `tags` list, the word `component` and if so, bingo, we've a related blog post.

## Conclusion

This article illustrate this. Below, you'll get the list of posts about `component`. Cards are injected automatically thanks to our overriding of the `BlogPostItem` template.
